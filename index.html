<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Инвентарь товаров</title>
<style>
  .group {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 15px;
  }
  ul {
    list-style: none;
    padding: 0;
  }
  li {
    margin-bottom: 5px;
  }
</style>
</head>
<body>
<h1>Инвентарь товаров</h1>

<div>
  <input type="text" id="nameInput" placeholder="Имя товара" />
  <input type="number" id="quantityInput" placeholder="Количество" />
  <select id="groupSelect">
    <option value="Розницы">Розницы</option>
    <option value="Опт">Опт</option>
    <option value="Интернет">Интернет</option>
    <option value="Магазин">Магазин</option>
  </select>
  <button id="addButton">Добавить товар</button>
</div>

<div id="inventoryContainer"></div>

<!-- Подключение Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

<script>
  // Ваша конфигурация Firebase - замените на свои параметры
  const firebaseConfig = {
    apiKey: "ВАШ_API_КЛЮЧ",
    authDomain: "ВАШ_ДОМЕН",
    projectId: "ВАШ_PROJECT_ID",
    // остальные параметры...
  };
  // Инициализация Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let inventoryData = {};

  // 1. Загрузка данных из Firestore
  async function loadData() {
    try {
      const snapshot = await db.collection('inventory').doc('data').get();
      if (snapshot.exists) {
        inventoryData = snapshot.data() || {};
      } else {
        // Структура по умолчанию, если данных нет
        inventoryData = {
          'Розницы': [],
          'Опт': [],
          'Интернет': [],
          'Магазин': [],
        };
        await saveData();
      }
    } catch (err) {
      console.error('Ошибка загрузки данных:', err);
      // Инициализация по умолчанию при ошибке
      inventoryData = {
        'Розницы': [],
        'Опт': [],
        'Интернет': [],
        'Магазин': [],
      };
    }
  }

  // 2. Сохранение данных в Firestore
  async function saveData() {
    try {
      await db.collection('inventory').doc('data').set(inventoryData);
    } catch (err) {
      console.error('Ошибка сохранения данных:', err);
    }
  }

  // 3. Отрисовка инвентаря
  const inventoryContainer = document.getElementById('inventoryContainer');

  function renderInventory() {
    inventoryContainer.innerHTML = '';

    for (const group in inventoryData) {
      const groupDiv = document.createElement('div');
      groupDiv.className = 'group';

      const groupTitle = document.createElement('h2');
      groupTitle.textContent = group;
      groupDiv.appendChild(groupTitle);

      const list = document.createElement('ul');

      inventoryData[group].forEach((item, index) => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `
          <button onclick="moveItem('${group}', ${index})">Переместить</button>
          <button onclick="removeItem('${group}', ${index})">Удалить</button>
          ${item.name} - ${item.quantity} шт.
          <button onclick="editItem('${group}', ${index})">Редактировать</button>
        `;
        list.appendChild(listItem);
      });

      groupDiv.appendChild(list);
      inventoryContainer.appendChild(groupDiv);
    }
  }

  // 4. Добавление нового товара
 document.getElementById('addButton').addEventListener('click', () => {
    const nameInput = document.getElementById('nameInput');
    const quantityInput = document.getElementById('quantityInput');
    const groupSelect = document.getElementById('groupSelect');

    const name = nameInput.value.trim();
    const quantity = parseInt(quantityInput.value, 10);
    const group = groupSelect.value;

    if (!name || isNaN(quantity) || quantity <= 0) {
      alert('Пожалуйста, введите корректное имя и количество.');
      return;
    }

    const newItem = { name, quantity };

    if (!inventoryData[group]) {
      inventoryData[group] = [];
    }

    inventoryData[group].push(newItem);
    saveData();
    renderInventory();

    // Очищение полей
    nameInput.value = '';
    quantityInput.value = '';
  });

  // 5. Удаление товара
  function removeItem(group, index) {
    if (inventoryData[group]) {
      inventoryData[group].splice(index, 1);
      saveData();
      renderInventory();
    }
  }

  // 6. Перемещение товара
  function moveItem(currentGroup, index) {
    const item = inventoryData[currentGroup][index];
    const targetGroup = prompt(`Введите группу для перемещения (${Object.keys(inventoryData).join(',')}):`, currentGroup);
    if (targetGroup && inventoryData[targetGroup]) {
      // Перемещаем товар
      inventoryData[targetGroup].push(item);
      inventoryData[currentGroup].splice(index, 1);
      saveData();
      renderInventory();
    } else {
      alert('Некорректная группа');
    }
  }

  // 7. Редактирование товара
  function editItem(group, index) {
    const item = inventoryData[group][index];
    const newName = prompt('Введите новое имя', item.name);
    const newQuantityStr = prompt('Введите новое количество', item.quantity);
    const newQuantity = parseInt(newQuantityStr, 10);

    if (newName !== null && newQuantityStr !== null && !isNaN(newQuantity) && newQuantity > 0) {
      inventoryData[group][index] = { name: newName.trim(), quantity: newQuantity };
      saveData();
      renderInventory();
    } else {
      alert('Некорректные данные');
    }
  }

  // 8. Инициализация
  (async () => {
    await loadData();
    renderInventory();
  })();
</script>
</body>
</html>
