<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Управление шариками в магазине</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { margin-bottom: 20px; }
    select, button, input { margin: 5px; }
    #itemsContainer div { display: inline-block; vertical-align: top; width: 200px; margin: 10px; padding: 10px; border: 1px solid #ccc; }
    img { width: 100%; height: auto; }
    button { margin-top: 5px; }
  </style>
</head>
<body>

<h1>Управление шариками в магазине</h1>

<!-- Выбор группы -->
<label for="groupSelect">Выберите группу:</label>
<select id="groupSelect">
  <option value="фольга">Фольга</option>
  <option value="фигуры">Фигуры</option>
  <option value="латекс">Латекс</option>
  <option value="хром">Хром</option>
  <option value="нет в наличии">Нет в наличии</option>
</select>
<button id="loadGroup">Показать</button>

<!-- Контейнер для отображения товаров -->
<div id="itemsContainer"></div>

<!-- Форма добавления разного шарика -->
<h2>Добавить шарик</h2>
<form id="addForm">
  <input type="text" id="name" placeholder="Название" required />
  <input type="number" id="count" placeholder="Количество" required min="0" />
  <input type="file" id="photo" accept="image/*" />
  <button type="submit">Добавить</button>
</form>

<!-- Подключение Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js"></script>

<script>
  // ВАШИ параметры Firebase. Замените на свои, если нужно!
  const firebaseConfig = {
    apiKey: "AIzaSyCDhmrq_EjhUC65ddcKABRYGZjFxSVah1M",
    authDomain: "shar-d04bb.firebaseapp.com",
    projectId: "shar-d04bb",
    storageBucket: "shar-d04bb.firebasestorage.app",
    messagingSenderId: "398332289232",
    appId: "1:398332289232:web:68d16813abe06580d13ed5",
    measurementId: "G-DXTCBFZYH6"
  };

  // Инициализация Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  let currentGroup = 'фольга'; // по умолчанию

  let unsubscribe = null;

  const groupSelect = document.getElementById('groupSelect');
  const loadButton = document.getElementById('loadGroup');
  const itemsContainer = document.getElementById('itemsContainer');

  // Загрузка и прослушка выбранной группы
  document.getElementById('loadGroup').onclick = () => {
    currentGroup = groupSelect.value;
    if (unsubscribe) { unsubscribe(); }
    itemsContainer.innerHTML = '';
    listenToGroup(currentGroup);
  };

  // Автозагрузка по умолчанию
 window.onload = () => {
   groupSelect.value = 'фольга';
   document.getElementById('loadGroup').click();
 };

 // Слушает изменения в текущей группе
function listenToGroup(groupName) {
  unsubscribe = db.collection('balls')
    .doc(groupName)
    .collection('items')
    .onSnapshot(snapshot => {
      itemsContainer.innerHTML = '';
      snapshot.forEach(doc => {
        createItemCard(doc.id, doc.data());
      });
    });
}

// Создаем карточку товара
function createItemCard(id, data) {
  const div = document.createElement('div');

  // Фото
  const img = document.createElement('img');
  img.src = data.photoUrl || '';
  div.appendChild(img);

  // Название
  const title = document.createElement('h4');
  title.textContent = data.name;
  div.appendChild(title);

  // Количество
  const countSpan = document.createElement('span');
  countSpan.textContent = `Кол-во: ${data.count}`;
  countSpan.style.cursor = 'pointer';
  countSpan.onclick = () => {
    const newCount = prompt('Введите новое количество:', data.count);
    if (newCount !== null) {
      updateItemCount(id, parseInt(newCount));
    }
  };
  div.appendChild(countSpan);

  // Редактировать имя
  const editBtn = document.createElement('button');
  editBtn.textContent = 'Редактировать название';
  editBtn.onclick = () => {
    const newName = prompt('Новое название:', data.name);
    if (newName !== null && newName.trim() !== '') {
      updateItemName(id, newName.trim());
    }
  };
  div.appendChild(editBtn);

  // Удалить
  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = 'Удалить';
  deleteBtn.onclick = () => {
    deleteItem(id);
  };
  div.appendChild(deleteBtn);

  itemsContainer.appendChild(div);
}

// Добавление нового шара
document.getElementById('addForm').onsubmit = async (e) => {
  e.preventDefault();

  const name = document.getElementById('name').value.trim();
  const count = parseInt(document.getElementById('count').value);
  const photoFile = document.getElementById('photo').files[0];

  let photoUrl = '';

  if (photoFile) {
    const storageRef = storage.ref();
    const fileRef = storageRef.child(`images/${Date.now()}_${photoFile.name}`);
    await fileRef.put(photoFile);
    photoUrl = await fileRef.getDownloadURL();
  }

  await db.collection('balls')
    .doc(currentGroup)
    .collection('items')
    .add({ name, count, photoUrl });

  document.getElementById('addForm').reset();
};

// Обновление имени
async function updateItemName(id, newName) {
  await db.collection('balls').doc(currentGroup).collection('items').doc(id).update({ name: newName });
}
// Обновление количества
async function updateItemCount(id, newCount) {
  await db.collection('balls').doc(currentGroup).collection('items').doc(id).update({ count: newCount });
}
// Удаление товара
async function deleteItem(id) {
  await db.collection('balls').doc(currentGroup).collection('items').doc(id).delete();
}
</script>

</body>
</html>